<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoM: AI based Personalized Health Assessment System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .content {
            display: none;
        }

        .content.active {
            display: block;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .anatomy-container {
            position: relative;
            width: 100%;
            height: 600px;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .body-part {
            cursor: pointer;
            transition: all 0.3s;
        }

        .body-part:hover {
            opacity: 1 !important;
        }

        .clickable-area {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid transparent;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .clickable-area:hover {
            background: rgba(102, 126, 234, 0.3);
            border: 2px solid #667eea;
            transform: scale(1.05);
        }

        .clickable-area.selected {
            background: rgba(102, 126, 234, 0.4);
            border: 2px solid #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.6);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group select, .form-group input, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s;
            font-family: inherit;
        }

        .form-group select:focus, .form-group input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .symptom-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .symptom-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            position: relative;
        }

        .symptom-item h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .symptom-item p {
            color: #666;
            font-size: 13px;
            margin: 3px 0;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background: #ffc107;
            color: #000;
        }

        .status-approved {
            background: #28a745;
            color: white;
        }

        .history-item {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .suggestion-box {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #2196F3;
            white-space: pre-line;
        }

        .doctor-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 13px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            float: right;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        .badge-count {
            background: #dc3545;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 5px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .markdown-content {
            line-height: 1.6;
        }

        .markdown-content h1 {
            font-size: 18px;
            color: #333;
            margin: 15px 0 10px 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .markdown-content h2 {
            font-size: 16px;
            color: #444;
            margin: 12px 0 8px 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 3px;
        }

        .markdown-content h3 {
            font-size: 14px;
            color: #555;
            margin: 10px 0 6px 0;
            font-weight: 600;
        }

        .markdown-content h4 {
            font-size: 13px;
            color: #666;
            margin: 8px 0 5px 0;
            font-weight: 600;
        }

        .markdown-content h5 {
            font-size: 12px;
            color: #666;
            margin: 6px 0 4px 0;
            font-weight: 600;
        }

        .markdown-content ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .markdown-content li {
            margin: 4px 0;
            color: #555;
        }

        .markdown-content strong {
            color: #333;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MoM: AI based Personalized Health Assessment System</h1>
            <p>Select body areas, describe symptoms, and receive AI-assisted medical guidance</p>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('patient')">Patient Portal</button>
                <button class="tab" onclick="switchTab('doctor')">
                    Doctor Portal <span class="badge-count" id="pendingCount">0</span>
                </button>
                <button class="tab" onclick="switchTab('history')">
                    History <span class="badge-count" id="historyCount">0</span>
                </button>
            </div>
        </div>

        <!-- Patient Portal -->
        <div id="patient-content" class="content active">
            <div class="main-grid">
                <div class="card">
                    <h2>Select Affected Body Area</h2>
                    <div class="anatomy-container">
                        <div style="position: relative; display: inline-block;">
                            <img src="FrontBody.png" alt="Human Anatomy" style="max-width: 100%; height: auto; max-height: 550px;">
                            
                            <!-- Invisible clickable areas over the anatomy image -->
                            <!-- Head -->
                            <div class="body-part clickable-area" data-part="head" onclick="selectBodyPart('head')" 
                                 style="position: absolute; top: 2%; left: 42%; width: 16%; height: 15%; cursor: pointer;" 
                                 title="Head"></div>
                            
                            <!-- Neck -->
                            <div class="body-part clickable-area" data-part="neck" onclick="selectBodyPart('neck')" 
                                 style="position: absolute; top: 17%; left: 46%; width: 8%; height: 5%; cursor: pointer;" 
                                 title="Neck"></div>
                            
                            <!-- Left Shoulder -->
                            <div class="body-part clickable-area" data-part="left-shoulder" onclick="selectBodyPart('left-shoulder')" 
                                 style="position: absolute; top: 20%; left: 28%; width: 15%; height: 8%; cursor: pointer;" 
                                 title="Left Shoulder"></div>
                            
                            <!-- Right Shoulder -->
                            <div class="body-part clickable-area" data-part="right-shoulder" onclick="selectBodyPart('right-shoulder')" 
                                 style="position: absolute; top: 20%; left: 57%; width: 15%; height: 8%; cursor: pointer;" 
                                 title="Right Shoulder"></div>
                            
                            <!-- Left Upper Arm -->
                            <div class="body-part clickable-area" data-part="left-upper-arm" onclick="selectBodyPart('left-upper-arm')" 
                                 style="position: absolute; top: 28%; left: 20%; width: 10%; height: 20%; cursor: pointer;" 
                                 title="Left Upper Arm"></div>
                            
                            <!-- Right Upper Arm -->
                            <div class="body-part clickable-area" data-part="right-upper-arm" onclick="selectBodyPart('right-upper-arm')" 
                                 style="position: absolute; top: 28%; left: 70%; width: 10%; height: 20%; cursor: pointer;" 
                                 title="Right Upper Arm"></div>
                            
                            <!-- Chest -->
                            <div class="body-part clickable-area" data-part="chest" onclick="selectBodyPart('chest')" 
                                 style="position: absolute; top: 22%; left: 38%; width: 24%; height: 20%; cursor: pointer;" 
                                 title="Chest"></div>
                            
                            <!-- Left Elbow -->
                            <div class="body-part clickable-area" data-part="left-elbow" onclick="selectBodyPart('left-elbow')" 
                                 style="position: absolute; top: 48%; left: 18%; width: 8%; height: 6%; cursor: pointer;" 
                                 title="Left Elbow"></div>
                            
                            <!-- Right Elbow -->
                            <div class="body-part clickable-area" data-part="right-elbow" onclick="selectBodyPart('right-elbow')" 
                                 style="position: absolute; top: 48%; left: 74%; width: 8%; height: 6%; cursor: pointer;" 
                                 title="Right Elbow"></div>
                            
                            <!-- Upper Abdomen -->
                            <div class="body-part clickable-area" data-part="upper-abdomen" onclick="selectBodyPart('upper-abdomen')" 
                                 style="position: absolute; top: 42%; left: 40%; width: 20%; height: 12%; cursor: pointer;" 
                                 title="Upper Abdomen"></div>
                            
                            <!-- Left Forearm -->
                            <div class="body-part clickable-area" data-part="left-forearm" onclick="selectBodyPart('left-forearm')" 
                                 style="position: absolute; top: 54%; left: 16%; width: 10%; height: 18%; cursor: pointer;" 
                                 title="Left Forearm"></div>
                            
                            <!-- Right Forearm -->
                            <div class="body-part clickable-area" data-part="right-forearm" onclick="selectBodyPart('right-forearm')" 
                                 style="position: absolute; top: 54%; left: 74%; width: 10%; height: 18%; cursor: pointer;" 
                                 title="Right Forearm"></div>
                            
                            <!-- Lower Abdomen -->
                            <div class="body-part clickable-area" data-part="lower-abdomen" onclick="selectBodyPart('lower-abdomen')" 
                                 style="position: absolute; top: 54%; left: 40%; width: 20%; height: 10%; cursor: pointer;" 
                                 title="Lower Abdomen"></div>
                            
                            <!-- Pelvis -->
                            <div class="body-part clickable-area" data-part="pelvis" onclick="selectBodyPart('pelvis')" 
                                 style="position: absolute; top: 64%; left: 40%; width: 20%; height: 8%; cursor: pointer;" 
                                 title="Pelvis"></div>
                            
                            <!-- Left Wrist -->
                            <div class="body-part clickable-area" data-part="left-wrist" onclick="selectBodyPart('left-wrist')" 
                                 style="position: absolute; top: 72%; left: 16%; width: 8%; height: 4%; cursor: pointer;" 
                                 title="Left Wrist"></div>
                            
                            <!-- Right Wrist -->
                            <div class="body-part clickable-area" data-part="right-wrist" onclick="selectBodyPart('right-wrist')" 
                                 style="position: absolute; top: 72%; left: 76%; width: 8%; height: 4%; cursor: pointer;" 
                                 title="Right Wrist"></div>
                            
                            <!-- Left Hand -->
                            <div class="body-part clickable-area" data-part="left-hand" onclick="selectBodyPart('left-hand')" 
                                 style="position: absolute; top: 76%; left: 26%; width: 8%; height: 10%; cursor: pointer;" 
                                 title="Left Hand"></div>
                            
                            <!-- Right Hand -->
                            <div class="body-part clickable-area" data-part="right-hand" onclick="selectBodyPart('right-hand')" 
                                 style="position: absolute; top: 76%; left: 66%; width: 8%; height: 10%; cursor: pointer;" 
                                 title="Right Hand"></div>
                            
                            <!-- Left Hip -->
                            <div class="body-part clickable-area" data-part="left-hip" onclick="selectBodyPart('left-hip')" 
                                 style="position: absolute; top: 72%; left: 36%; width: 10%; height: 8%; cursor: pointer;" 
                                 title="Left Hip"></div>
                            
                            <!-- Right Hip -->
                            <div class="body-part clickable-area" data-part="right-hip" onclick="selectBodyPart('right-hip')" 
                                 style="position: absolute; top: 72%; left: 54%; width: 10%; height: 8%; cursor: pointer;" 
                                 title="Right Hip"></div>
                            
                            <!-- Left Thigh -->
                            <div class="body-part clickable-area" data-part="left-thigh" onclick="selectBodyPart('left-thigh')" 
                                 style="position: absolute; top: 80%; left: 40%; width: 8%; height: 24%; cursor: pointer;" 
                                 title="Left Thigh"></div>
                            
                            <!-- Right Thigh -->
                            <div class="body-part clickable-area" data-part="right-thigh" onclick="selectBodyPart('right-thigh')" 
                                 style="position: absolute; top: 80%; left: 52%; width: 8%; height: 24%; cursor: pointer;" 
                                 title="Right Thigh"></div>
                            
                            <!-- Left Knee -->
                            <div class="body-part clickable-area" data-part="left-knee" onclick="selectBodyPart('left-knee')" 
                                 style="position: absolute; top: 105%; left: 38%; width: 8%; height: 6%; cursor: pointer;" 
                                 title="Left Knee"></div>
                            
                            <!-- Right Knee -->
                            <div class="body-part clickable-area" data-part="right-knee" onclick="selectBodyPart('right-knee')" 
                                 style="position: absolute; top: 105%; left: 54%; width: 8%; height: 6%; cursor: pointer;" 
                                 title="Right Knee"></div>
                            
                            <!-- More specific head areas -->
                            <!-- Forehead -->
                            <div class="body-part clickable-area" data-part="forehead" onclick="selectBodyPart('forehead')" 
                                 style="position: absolute; top: 4%; left: 44%; width: 12%; height: 6%; cursor: pointer;" 
                                 title="Forehead"></div>
                            
                            <!-- Left Eye -->
                            <div class="body-part clickable-area" data-part="left-eye" onclick="selectBodyPart('left-eye')" 
                                 style="position: absolute; top: 8%; left: 44%; width: 4%; height: 3%; cursor: pointer;" 
                                 title="Left Eye"></div>
                            
                            <!-- Right Eye -->
                            <div class="body-part clickable-area" data-part="right-eye" onclick="selectBodyPart('right-eye')" 
                                 style="position: absolute; top: 8%; left: 52%; width: 4%; height: 3%; cursor: pointer;" 
                                 title="Right Eye"></div>
                            
                            <!-- Nose -->
                            <div class="body-part clickable-area" data-part="nose" onclick="selectBodyPart('nose')" 
                                 style="position: absolute; top: 10%; left: 47%; width: 6%; height: 4%; cursor: pointer;" 
                                 title="Nose"></div>
                            
                            <!-- Mouth -->
                            <div class="body-part clickable-area" data-part="mouth" onclick="selectBodyPart('mouth')" 
                                 style="position: absolute; top: 13%; left: 46%; width: 8%; height: 3%; cursor: pointer;" 
                                 title="Mouth"></div>
                            
                            <!-- Left Ear -->
                            <div class="body-part clickable-area" data-part="left-ear" onclick="selectBodyPart('left-ear')" 
                                 style="position: absolute; top: 8%; left: 38%; width: 6%; height: 6%; cursor: pointer;" 
                                 title="Left Ear"></div>
                            
                            <!-- Right Ear -->
                            <div class="body-part clickable-area" data-part="right-ear" onclick="selectBodyPart('right-ear')" 
                                 style="position: absolute; top: 8%; left: 56%; width: 6%; height: 6%; cursor: pointer;" 
                                 title="Right Ear"></div>
                            
                            <!-- Left Shin -->
                            <div class="body-part clickable-area" data-part="left-shin" onclick="selectBodyPart('left-shin')" 
                                 style="position: absolute; top: 111%; left: 42%; width: 6%; height: 20%; cursor: pointer;" 
                                 title="Left Shin"></div>
                            
                            <!-- Right Shin -->
                            <div class="body-part clickable-area" data-part="right-shin" onclick="selectBodyPart('right-shin')" 
                                 style="position: absolute; top: 111%; left: 52%; width: 6%; height: 20%; cursor: pointer;" 
                                 title="Right Shin"></div>
                            
                            <!-- Left Calf -->
                            <div class="body-part clickable-area" data-part="left-calf" onclick="selectBodyPart('left-calf')" 
                                 style="position: absolute; top: 111%; left: 38%; width: 6%; height: 20%; cursor: pointer;" 
                                 title="Left Calf"></div>
                            
                            <!-- Right Calf -->
                            <div class="body-part clickable-area" data-part="right-calf" onclick="selectBodyPart('right-calf')" 
                                 style="position: absolute; top: 111%; left: 56%; width: 6%; height: 20%; cursor: pointer;" 
                                 title="Right Calf"></div>
                            
                            <!-- Left Ankle -->
                            <div class="body-part clickable-area" data-part="left-ankle" onclick="selectBodyPart('left-ankle')" 
                                 style="position: absolute; top: 131%; left: 38%; width: 8%; height: 5%; cursor: pointer;" 
                                 title="Left Ankle"></div>
                            
                            <!-- Right Ankle -->
                            <div class="body-part clickable-area" data-part="right-ankle" onclick="selectBodyPart('right-ankle')" 
                                 style="position: absolute; top: 131%; left: 54%; width: 8%; height: 5%; cursor: pointer;" 
                                 title="Right Ankle"></div>
                            
                            <!-- Left Foot -->
                            <div class="body-part clickable-area" data-part="left-foot" onclick="selectBodyPart('left-foot')" 
                                 style="position: absolute; top: 136%; left: 36%; width: 10%; height: 8%; cursor: pointer;" 
                                 title="Left Foot"></div>
                            
                            <!-- Right Foot -->
                            <div class="body-part clickable-area" data-part="right-foot" onclick="selectBodyPart('right-foot')" 
                                 style="position: absolute; top: 136%; left: 54%; width: 10%; height: 8%; cursor: pointer;" 
                                 title="Right Foot"></div>
                            
                            <!-- More specific torso areas -->
                            <!-- Heart Area -->
                            <div class="body-part clickable-area" data-part="heart" onclick="selectBodyPart('heart')" 
                                 style="position: absolute; top: 25%; left: 42%; width: 10%; height: 8%; cursor: pointer;" 
                                 title="Heart Area"></div>
                            
                            <!-- Left Lung -->
                            <div class="body-part clickable-area" data-part="left-lung" onclick="selectBodyPart('left-lung')" 
                                 style="position: absolute; top: 24%; left: 32%; width: 12%; height: 14%; cursor: pointer;" 
                                 title="Left Lung"></div>
                            
                            <!-- Right Lung -->
                            <div class="body-part clickable-area" data-part="right-lung" onclick="selectBodyPart('right-lung')" 
                                 style="position: absolute; top: 24%; left: 56%; width: 12%; height: 14%; cursor: pointer;" 
                                 title="Right Lung"></div>
                            
                            <!-- Stomach -->
                            <div class="body-part clickable-area" data-part="stomach" onclick="selectBodyPart('stomach')" 
                                 style="position: absolute; top: 44%; left: 38%; width: 12%; height: 8%; cursor: pointer;" 
                                 title="Stomach"></div>
                            
                            <!-- Liver -->
                            <div class="body-part clickable-area" data-part="liver" onclick="selectBodyPart('liver')" 
                                 style="position: absolute; top: 42%; left: 50%; width: 12%; height: 8%; cursor: pointer;" 
                                 title="Liver"></div>
                            
                            <!-- Left Kidney -->
                            <div class="body-part clickable-area" data-part="left-kidney" onclick="selectBodyPart('left-kidney')" 
                                 style="position: absolute; top: 48%; left: 36%; width: 8%; height: 8%; cursor: pointer;" 
                                 title="Left Kidney"></div>
                            
                            <!-- Right Kidney -->
                            <div class="body-part clickable-area" data-part="right-kidney" onclick="selectBodyPart('right-kidney')" 
                                 style="position: absolute; top: 48%; left: 56%; width: 8%; height: 8%; cursor: pointer;" 
                                 title="Right Kidney"></div>
                            
                            <!-- Bladder -->
                            <div class="body-part clickable-area" data-part="bladder" onclick="selectBodyPart('bladder')" 
                                 style="position: absolute; top: 60%; left: 44%; width: 12%; height: 6%; cursor: pointer;" 
                                 title="Bladder"></div>
                            
                            <!-- More specific finger areas -->
                            <!-- Left Thumb -->
                            <div class="body-part clickable-area" data-part="left-thumb" onclick="selectBodyPart('left-thumb')" 
                                 style="position: absolute; top: 78%; left: 22%; width: 4%; height: 4%; cursor: pointer;" 
                                 title="Left Thumb"></div>
                            
                            <!-- Left Fingers -->
                            <div class="body-part clickable-area" data-part="left-fingers" onclick="selectBodyPart('left-fingers')" 
                                 style="position: absolute; top: 82%; left: 26%; width: 6%; height: 6%; cursor: pointer;" 
                                 title="Left Fingers"></div>
                            
                            <!-- Right Thumb -->
                            <div class="body-part clickable-area" data-part="right-thumb" onclick="selectBodyPart('right-thumb')" 
                                 style="position: absolute; top: 78%; left: 74%; width: 4%; height: 4%; cursor: pointer;" 
                                 title="Right Thumb"></div>
                            
                            <!-- Right Fingers -->
                            <div class="body-part clickable-area" data-part="right-fingers" onclick="selectBodyPart('right-fingers')" 
                                 style="position: absolute; top: 82%; left: 68%; width: 6%; height: 6%; cursor: pointer;" 
                                 title="Right Fingers"></div>
                        </div>
                    </div>
                    <p style="text-align: center; color: #666; margin-top: 10px;">Click on specific body areas to select • 40+ detailed anatomical regions • Symptom options will appear based on your selection</p>
                </div>

                <div class="card">
                    <h2>Symptom Details</h2>
                    <div class="form-group">
                        <label>Patient Name</label>
                        <input type="text" id="patientName" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label>Selected Body Part</label>
                        <input type="text" id="selectedPart" readonly placeholder="Click on body diagram" style="background: #f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>Symptom/Condition</label>
                        <select id="symptomType">
                            <option value="">Select a body area first to see relevant symptoms</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Duration</label>
                        <select id="duration">
                            <option value="">Select duration...</option>
                            <option value="less-than-1-day">Less than 1 day</option>
                            <option value="1-3-days">1-3 days</option>
                            <option value="4-7-days">4-7 days</option>
                            <option value="1-2-weeks">1-2 weeks</option>
                            <option value="2-4-weeks">2-4 weeks</option>
                            <option value="1-3-months">1-3 months</option>
                            <option value="more-than-3-months">More than 3 months</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Severity (1-10)</label>
                        <input type="number" id="severity" min="1" max="10" placeholder="1 (mild) to 10 (severe)">
                    </div>
                    <div class="form-group">
                        <label>Additional Details (Optional)</label>
                        <textarea id="symptomDetails" placeholder="Describe any additional details about the symptom (e.g., triggers, what makes it better/worse, associated symptoms)" rows="3"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="addSymptom()">Add Symptom</button>
                </div>
            </div>

            <div class="card">
                <h2>Current Symptoms</h2>
                <div class="symptom-list" id="symptomList">
                    <p style="color: #999;">No symptoms added yet. Add symptoms using the form above.</p>
                </div>
                <button class="btn btn-primary" onclick="submitToAI()" id="submitBtn" disabled>Submit to AI Analysis</button>
            </div>

            <div id="aiResponse"></div>
        </div>

        <!-- Doctor Portal -->
        <div id="doctor-content" class="content">
            <div class="card">
                <h2>Pending Reviews</h2>
                <div class="form-group">
                    <label>Doctor Name</label>
                    <input type="text" id="doctorName" placeholder="Enter your name">
                </div>
                <div id="pendingList"></div>
            </div>
        </div>

        <!-- History -->
        <div id="history-content" class="content">
            <div class="card">
                <h2>Patient History</h2>
                <div class="form-group">
                    <label>Filter by Patient Name</label>
                    <input type="text" id="historyFilter" placeholder="Enter patient name" onkeyup="filterHistory()">
                </div>
                <div id="historyList"></div>
            </div>
        </div>
    </div>

    <script>
        // Database
        const database = {
            submissions: [],
            history: []
        };

        let currentSymptoms = [];
        let selectedBodyPart = null;

        // Comprehensive symptom-to-body-part mapping
        const bodyPartSymptoms = {
            // Head/Face areas
            'head': ['sharp-pain', 'dull-ache', 'throbbing-pain', 'pressure-headache', 'migraine', 'tension-headache', 'dizziness', 'confusion', 'memory-issues'],
            'forehead': ['throbbing-pain', 'pressure-headache', 'migraine', 'tension-headache', 'sinus-pressure'],
            'left-eye': ['sharp-pain', 'dull-ache', 'vision-blurred', 'vision-double', 'eye-discharge', 'dry-eyes', 'redness', 'itching', 'light-sensitivity'],
            'right-eye': ['sharp-pain', 'dull-ache', 'vision-blurred', 'vision-double', 'eye-discharge', 'dry-eyes', 'redness', 'itching', 'light-sensitivity'],
            'left-ear': ['sharp-pain', 'dull-ache', 'hearing-loss', 'ear-discharge', 'tinnitus', 'dizziness', 'itching'],
            'right-ear': ['sharp-pain', 'dull-ache', 'hearing-loss', 'ear-discharge', 'tinnitus', 'dizziness', 'itching'],
            'nose': ['congestion', 'runny-nose', 'nosebleed', 'loss-of-smell', 'sinus-pressure', 'nasal-discharge'],
            'mouth': ['dry-mouth', 'mouth-sores', 'bad-breath', 'taste-changes', 'difficulty-swallowing', 'jaw-pain'],
            'neck': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'swollen-lymph-nodes', 'difficulty-swallowing'],

            // Upper body
            'left-shoulder': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'weakness', 'clicking-popping', 'instability'],
            'right-shoulder': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'weakness', 'clicking-popping', 'instability'],
            'left-upper-arm': ['sharp-pain', 'dull-ache', 'weakness', 'numbness', 'tingling', 'muscle-spasms', 'bruising'],
            'right-upper-arm': ['sharp-pain', 'dull-ache', 'weakness', 'numbness', 'tingling', 'muscle-spasms', 'bruising'],
            'left-elbow': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'clicking-popping', 'weakness', 'tingling'],
            'right-elbow': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'clicking-popping', 'weakness', 'tingling'],
            'left-forearm': ['sharp-pain', 'dull-ache', 'numbness', 'tingling', 'weakness', 'muscle-spasms'],
            'right-forearm': ['sharp-pain', 'dull-ache', 'numbness', 'tingling', 'weakness', 'muscle-spasms'],
            'left-wrist': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'numbness', 'tingling', 'weakness', 'clicking-popping'],
            'right-wrist': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'numbness', 'tingling', 'weakness', 'clicking-popping'],
            'left-hand': ['sharp-pain', 'dull-ache', 'numbness', 'tingling', 'stiffness', 'weakness', 'mild-swelling', 'skin-discoloration'],
            'right-hand': ['sharp-pain', 'dull-ache', 'numbness', 'tingling', 'stiffness', 'weakness', 'mild-swelling', 'skin-discoloration'],
            'left-thumb': ['sharp-pain', 'dull-ache', 'numbness', 'tingling', 'stiffness', 'weakness'],
            'right-thumb': ['sharp-pain', 'dull-ache', 'numbness', 'tingling', 'stiffness', 'weakness'],
            'left-fingers': ['sharp-pain', 'dull-ache', 'numbness', 'tingling', 'stiffness', 'weakness', 'joint-locking'],
            'right-fingers': ['sharp-pain', 'dull-ache', 'numbness', 'tingling', 'stiffness', 'weakness', 'joint-locking'],

            // Torso
            'chest': ['sharp-pain', 'dull-ache', 'chest-tightness', 'shortness-of-breath', 'rapid-heartbeat', 'chest-pressure'],
            'heart': ['chest-pain', 'chest-tightness', 'rapid-heartbeat', 'irregular-heartbeat', 'shortness-of-breath', 'fatigue', 'dizziness'],
            'left-lung': ['shortness-of-breath', 'chest-pain', 'cough-dry', 'cough-productive', 'wheezing', 'chest-tightness'],
            'right-lung': ['shortness-of-breath', 'chest-pain', 'cough-dry', 'cough-productive', 'wheezing', 'chest-tightness'],
            'upper-abdomen': ['sharp-pain', 'dull-ache', 'burning-pain', 'cramping-pain', 'nausea', 'bloating', 'heartburn'],
            'lower-abdomen': ['sharp-pain', 'dull-ache', 'cramping-pain', 'bloating', 'nausea', 'diarrhea', 'constipation'],
            'stomach': ['nausea', 'vomiting', 'burning-pain', 'cramping-pain', 'bloating', 'heartburn', 'loss-of-appetite'],
            'liver': ['dull-ache', 'sharp-pain', 'nausea', 'fatigue', 'skin-discoloration', 'bloating'],
            'left-kidney': ['dull-ache', 'sharp-pain', 'burning-pain', 'frequent-urination', 'blood-in-urine', 'nausea'],
            'right-kidney': ['dull-ache', 'sharp-pain', 'burning-pain', 'frequent-urination', 'blood-in-urine', 'nausea'],
            'bladder': ['burning-pain', 'frequent-urination', 'urgent-urination', 'blood-in-urine', 'pelvic-pain'],
            'pelvis': ['sharp-pain', 'dull-ache', 'cramping-pain', 'pelvic-pressure', 'frequent-urination'],

            // Lower body
            'left-hip': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'weakness', 'clicking-popping', 'instability'],
            'right-hip': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'weakness', 'clicking-popping', 'instability'],
            'left-thigh': ['sharp-pain', 'dull-ache', 'muscle-spasms', 'numbness', 'tingling', 'weakness', 'bruising'],
            'right-thigh': ['sharp-pain', 'dull-ache', 'muscle-spasms', 'numbness', 'tingling', 'weakness', 'bruising'],
            'left-knee': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'mild-swelling', 'clicking-popping', 'instability', 'joint-locking'],
            'right-knee': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'mild-swelling', 'clicking-popping', 'instability', 'joint-locking'],
            'left-shin': ['sharp-pain', 'dull-ache', 'muscle-spasms', 'numbness', 'tingling'],
            'right-shin': ['sharp-pain', 'dull-ache', 'muscle-spasms', 'numbness', 'tingling'],
            'left-calf': ['sharp-pain', 'dull-ache', 'muscle-spasms', 'cramping-pain', 'mild-swelling', 'numbness'],
            'right-calf': ['sharp-pain', 'dull-ache', 'muscle-spasms', 'cramping-pain', 'mild-swelling', 'numbness'],
            'left-ankle': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'mild-swelling', 'instability', 'clicking-popping'],
            'right-ankle': ['sharp-pain', 'dull-ache', 'stiffness', 'limited-range', 'mild-swelling', 'instability', 'clicking-popping'],
            'left-foot': ['sharp-pain', 'dull-ache', 'numbness', 'tingling', 'stiffness', 'mild-swelling', 'skin-discoloration'],
            'right-foot': ['sharp-pain', 'dull-ache', 'numbness', 'tingling', 'stiffness', 'mild-swelling', 'skin-discoloration']
        };

        // Extended symptom definitions for new medical-specific symptoms
        const allSymptoms = {
            // Pain types
            'sharp-pain': 'Sharp/Stabbing Pain',
            'dull-ache': 'Dull Ache',
            'throbbing-pain': 'Throbbing Pain',
            'burning-pain': 'Burning Pain',
            'cramping-pain': 'Cramping Pain',
            'shooting-pain': 'Shooting Pain',
            'pressure-headache': 'Pressure Headache',
            'migraine': 'Migraine',
            'tension-headache': 'Tension Headache',
            'chest-pain': 'Chest Pain',
            'pelvic-pain': 'Pelvic Pain',
            'jaw-pain': 'Jaw Pain',

            // Swelling & Inflammation
            'mild-swelling': 'Mild Swelling',
            'moderate-swelling': 'Moderate Swelling',
            'severe-swelling': 'Severe Swelling',
            'redness': 'Redness',
            'warmth': 'Warmth/Heat',
            'bruising': 'Bruising',

            // Neurological
            'numbness': 'Numbness',
            'tingling': 'Tingling/Pins & Needles',
            'weakness': 'Muscle Weakness',
            'muscle-spasms': 'Muscle Spasms',
            'tremor': 'Tremor/Shaking',
            'loss-of-sensation': 'Loss of Sensation',
            'confusion': 'Confusion',
            'memory-issues': 'Memory Issues',

            // Movement & Function
            'stiffness': 'Stiffness',
            'limited-range': 'Limited Range of Motion',
            'joint-locking': 'Joint Locking',
            'instability': 'Instability/Giving Way',
            'clicking-popping': 'Clicking/Popping',
            'grinding': 'Grinding Sensation',

            // Vision & Hearing
            'vision-blurred': 'Blurred Vision',
            'vision-double': 'Double Vision',
            'hearing-loss': 'Hearing Loss',
            'tinnitus': 'Tinnitus/Ringing',
            'light-sensitivity': 'Light Sensitivity',
            'dry-eyes': 'Dry Eyes',

            // Respiratory
            'shortness-of-breath': 'Shortness of Breath',
            'wheezing': 'Wheezing',
            'chest-tightness': 'Chest Tightness',
            'cough-dry': 'Dry Cough',
            'cough-productive': 'Productive Cough',
            'rapid-heartbeat': 'Rapid Heartbeat',
            'irregular-heartbeat': 'Irregular Heartbeat',
            'chest-pressure': 'Chest Pressure',

            // Digestive & Urinary
            'nausea': 'Nausea',
            'vomiting': 'Vomiting',
            'diarrhea': 'Diarrhea',
            'constipation': 'Constipation',
            'bloating': 'Bloating',
            'heartburn': 'Heartburn',
            'loss-of-appetite': 'Loss of Appetite',
            'frequent-urination': 'Frequent Urination',
            'urgent-urination': 'Urgent Urination',
            'blood-in-urine': 'Blood in Urine',
            'difficulty-swallowing': 'Difficulty Swallowing',

            // Skin & Surface
            'rash': 'Rash',
            'itching': 'Itching',
            'dry-skin': 'Dry Skin',
            'skin-discoloration': 'Skin Discoloration',
            'open-wound': 'Open Wound/Cut',
            'blisters': 'Blisters',

            // ENT specific
            'congestion': 'Nasal Congestion',
            'runny-nose': 'Runny Nose',
            'nosebleed': 'Nosebleed',
            'loss-of-smell': 'Loss of Smell',
            'sinus-pressure': 'Sinus Pressure',
            'nasal-discharge': 'Nasal Discharge',
            'ear-discharge': 'Ear Discharge',
            'dry-mouth': 'Dry Mouth',
            'mouth-sores': 'Mouth Sores',
            'bad-breath': 'Bad Breath',
            'taste-changes': 'Taste Changes',
            'swollen-lymph-nodes': 'Swollen Lymph Nodes',
            'eye-discharge': 'Eye Discharge',
            'pelvic-pressure': 'Pelvic Pressure',

            // General
            'fever': 'Fever',
            'chills': 'Chills',
            'fatigue': 'Fatigue',
            'dizziness': 'Dizziness',
            'headache': 'Headache',
            'night-sweats': 'Night Sweats',

            // Other
            'discharge': 'Discharge',
            'odor': 'Unusual Odor',
            'temperature-change': 'Temperature Change',
            'other': 'Other (describe in notes)'
        };

        // Simple markdown renderer for medical text
        function renderMarkdown(text) {
            if (!text) return '';
            
            // Split into lines first to process line-by-line
            const lines = text.split('\n');
            const processedLines = [];
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];
                
                // Process headers
                if (line.match(/^##### /)) {
                    line = line.replace(/^##### (.*)/, '<h5>$1</h5>');
                } else if (line.match(/^#### /)) {
                    line = line.replace(/^#### (.*)/, '<h4>$1</h4>');
                } else if (line.match(/^### /)) {
                    line = line.replace(/^### (.*)/, '<h3>$1</h3>');
                } else if (line.match(/^## /)) {
                    line = line.replace(/^## (.*)/, '<h2>$1</h2>');
                } else if (line.match(/^# /)) {
                    line = line.replace(/^# (.*)/, '<h1>$1</h1>');
                }
                
                // Process bullet points
                if (line.match(/^- /)) {
                    line = line.replace(/^- (.*)/, '<li>$1</li>');
                } else if (line.match(/^\d+\. /)) {
                    line = line.replace(/^(\d+)\. (.*)/, '<li>$2</li>');
                }
                
                // Process bold text
                line = line.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                processedLines.push(line);
            }
            
            // Join lines back together
            let result = processedLines.join('\n');
            
            // Group consecutive list items in <ul> tags
            result = result.replace(/(<li>.*<\/li>\n?)+/g, function(match) {
                const listItems = match.replace(/\n/g, '');
                return '<ul>' + listItems + '</ul>\n';
            });
            
            // Convert remaining newlines to <br>
            result = result.replace(/\n/g, '<br>');
            
            // Clean up spacing around lists and headers
            result = result.replace(/<br>\s*<ul>/g, '<ul>');
            result = result.replace(/<\/ul>\s*<br>/g, '</ul>');
            result = result.replace(/<br>\s*<h([1-6])>/g, '<h$1>');
            result = result.replace(/<\/h([1-6])>\s*<br>/g, '</h$1><br>');
            
            // Remove excessive <br> tags
            result = result.replace(/(<br>\s*){3,}/g, '<br><br>');
            
            return result;
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-content').classList.add('active');
            
            if (tab === 'doctor') {
                loadPendingReviews();
            } else if (tab === 'history') {
                loadHistory();
            }
        }

        function selectBodyPart(part) {
            // Remove selection from all clickable areas
            document.querySelectorAll('.clickable-area').forEach(area => {
                area.classList.remove('selected');
            });
            
            // Add selection to clicked area
            event.currentTarget.classList.add('selected');
            
            selectedBodyPart = part;
            
            // Format the body part name for display
            const formattedPart = part
                .replace(/-/g, ' ')
                .replace(/\b\w/g, l => l.toUpperCase());
            
            document.getElementById('selectedPart').value = formattedPart;
            
            // Update symptom dropdown based on selected body part
            updateSymptomDropdown(part);
        }

        function updateSymptomDropdown(bodyPart) {
            const symptomSelect = document.getElementById('symptomType');
            const relevantSymptoms = bodyPartSymptoms[bodyPart] || [];
            
            // Clear existing options
            symptomSelect.innerHTML = '<option value="">Select symptom...</option>';
            
            if (relevantSymptoms.length === 0) {
                // If no specific symptoms mapped, show all symptoms
                populateAllSymptoms();
                return;
            }
            
            // Group symptoms by category for better organization
            const symptomCategories = {
                'Pain': ['sharp-pain', 'dull-ache', 'throbbing-pain', 'burning-pain', 'cramping-pain', 'shooting-pain', 'pressure-headache', 'migraine', 'tension-headache', 'chest-pain', 'pelvic-pain', 'jaw-pain'],
                'Neurological': ['numbness', 'tingling', 'weakness', 'muscle-spasms', 'tremor', 'loss-of-sensation', 'confusion', 'memory-issues'],
                'Movement': ['stiffness', 'limited-range', 'joint-locking', 'instability', 'clicking-popping', 'grinding'],
                'Swelling': ['mild-swelling', 'moderate-swelling', 'severe-swelling', 'redness', 'warmth', 'bruising'],
                'Vision/Hearing': ['vision-blurred', 'vision-double', 'hearing-loss', 'tinnitus', 'light-sensitivity', 'dry-eyes', 'eye-discharge', 'ear-discharge'],
                'Respiratory': ['shortness-of-breath', 'wheezing', 'chest-tightness', 'cough-dry', 'cough-productive', 'rapid-heartbeat', 'irregular-heartbeat', 'chest-pressure'],
                'Digestive': ['nausea', 'vomiting', 'diarrhea', 'constipation', 'bloating', 'heartburn', 'loss-of-appetite', 'difficulty-swallowing'],
                'Urinary': ['frequent-urination', 'urgent-urination', 'blood-in-urine', 'pelvic-pressure'],
                'ENT': ['congestion', 'runny-nose', 'nosebleed', 'loss-of-smell', 'sinus-pressure', 'nasal-discharge', 'dry-mouth', 'mouth-sores', 'bad-breath', 'taste-changes', 'swollen-lymph-nodes'],
                'Skin': ['rash', 'itching', 'dry-skin', 'skin-discoloration', 'open-wound', 'blisters'],
                'General': ['fever', 'chills', 'fatigue', 'dizziness', 'headache', 'night-sweats', 'discharge', 'odor', 'temperature-change', 'other']
            };
            
            // Add relevant symptoms grouped by category
            Object.keys(symptomCategories).forEach(category => {
                const categorySymptoms = symptomCategories[category].filter(symptom => 
                    relevantSymptoms.includes(symptom)
                );
                
                if (categorySymptoms.length > 0) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = category;
                    
                    categorySymptoms.forEach(symptomKey => {
                        const option = document.createElement('option');
                        option.value = symptomKey;
                        option.textContent = allSymptoms[symptomKey] || symptomKey;
                        optgroup.appendChild(option);
                    });
                    
                    symptomSelect.appendChild(optgroup);
                }
            });
            
            // Always add "Other" option at the end
            if (!relevantSymptoms.includes('other')) {
                const otherOption = document.createElement('option');
                otherOption.value = 'other';
                otherOption.textContent = 'Other (describe in notes)';
                symptomSelect.appendChild(otherOption);
            }
        }

        function populateAllSymptoms() {
            const symptomSelect = document.getElementById('symptomType');
            
            const allCategories = {
                'Pain Types': ['sharp-pain', 'dull-ache', 'throbbing-pain', 'burning-pain', 'cramping-pain', 'shooting-pain'],
                'Swelling & Inflammation': ['mild-swelling', 'moderate-swelling', 'severe-swelling', 'redness', 'warmth', 'bruising'],
                'Neurological': ['numbness', 'tingling', 'weakness', 'muscle-spasms', 'tremor', 'loss-of-sensation'],
                'Movement & Function': ['stiffness', 'limited-range', 'joint-locking', 'instability', 'clicking-popping', 'grinding'],
                'Skin & Surface': ['rash', 'itching', 'dry-skin', 'skin-discoloration', 'open-wound', 'blisters'],
                'Respiratory': ['shortness-of-breath', 'wheezing', 'chest-tightness', 'cough-dry', 'cough-productive'],
                'Digestive': ['nausea', 'vomiting', 'diarrhea', 'constipation', 'bloating'],
                'General': ['fever', 'chills', 'fatigue', 'dizziness', 'headache', 'night-sweats'],
                'Other': ['other']
            };
            
            Object.keys(allCategories).forEach(category => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = category;
                
                allCategories[category].forEach(symptomKey => {
                    const option = document.createElement('option');
                    option.value = symptomKey;
                    option.textContent = allSymptoms[symptomKey] || symptomKey;
                    optgroup.appendChild(option);
                });
                
                symptomSelect.appendChild(optgroup);
            });
        }

        function addSymptom() {
            const patientName = document.getElementById('patientName').value;
            const bodyPart = selectedBodyPart;
            const symptomType = document.getElementById('symptomType').value;
            const duration = document.getElementById('duration').value;
            const severity = document.getElementById('severity').value;

            if (!patientName || !bodyPart || !symptomType || !duration || !severity) {
                alert('Please fill in all fields and select a body part');
                return;
            }

            const symptomDetails = document.getElementById('symptomDetails').value;
            
            const symptom = {
                id: Date.now(),
                patientName,
                bodyPart,
                symptomType,
                duration,
                severity: parseInt(severity),
                details: symptomDetails || ''
            };

            currentSymptoms.push(symptom);
            renderSymptomList();
            
            document.getElementById('symptomType').value = '';
            document.getElementById('duration').value = '';
            document.getElementById('severity').value = '';
            document.getElementById('symptomDetails').value = '';
            document.querySelectorAll('.clickable-area').forEach(area => {
                area.classList.remove('selected');
            });
            selectedBodyPart = null;
            document.getElementById('selectedPart').value = '';

            document.getElementById('submitBtn').disabled = false;
        }

        function removeSymptom(id) {
            currentSymptoms = currentSymptoms.filter(s => s.id !== id);
            renderSymptomList();
            if (currentSymptoms.length === 0) {
                document.getElementById('submitBtn').disabled = true;
            }
        }

        function renderSymptomList() {
            const list = document.getElementById('symptomList');
            if (currentSymptoms.length === 0) {
                list.innerHTML = '<p style="color: #999;">No symptoms added yet.</p>';
                return;
            }

            list.innerHTML = currentSymptoms.map(s => {
                const formattedBodyPart = s.bodyPart.replace(/-/g, ' ').toUpperCase();
                const formattedSymptom = s.symptomType.replace(/-/g, ' ').toUpperCase();
                const formattedDuration = s.duration.replace(/-/g, ' ');
                
                return `
                    <div class="symptom-item">
                        <button class="remove-btn" onclick="removeSymptom(${s.id})">Remove</button>
                        <h4>${formattedSymptom} - ${formattedBodyPart}</h4>
                        <p><strong>Duration:</strong> ${formattedDuration}</p>
                        <p><strong>Severity:</strong> ${s.severity}/10</p>
                        ${s.details ? `<p><strong>Details:</strong> ${s.details}</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        async function submitToAI() {
            if (currentSymptoms.length === 0) return;

            const patientName = currentSymptoms[0].patientName;
            const symptomsText = currentSymptoms.map(s => {
                const baseInfo = `- ${s.symptomType.replace(/-/g, ' ')} in ${s.bodyPart.replace(/-/g, ' ')}, Duration: ${s.duration.replace(/-/g, ' ')}, Severity: ${s.severity}/10`;
                return s.details ? `${baseInfo}\n  Additional details: ${s.details}` : baseInfo;
            }).join('\n');

            // Show loading state
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').textContent = 'Analyzing with AI...';
            
            document.getElementById('aiResponse').innerHTML = `
                <div class="card" style="margin-top: 20px;">
                    <h2>AI Analysis in Progress</h2>
                    <div style="text-align: center; padding: 20px;">
                        <div style="display: inline-block; animation: spin 1s linear infinite; width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #667eea; border-radius: 50%;"></div>
                        <p style="margin-top: 10px; color: #666;">Consulting Ollama AI model (qwen3:30b)...</p>
                        <div style="margin-top: 20px;">
                            <div style="width: 100%; background-color: #f0f0f0; border-radius: 10px; height: 20px; overflow: hidden;">
                                <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 10px; transition: width 0.5s ease;"></div>
                            </div>
                            <p id="progressText" style="margin-top: 10px; color: #666; font-size: 14px;">Estimated time remaining: 2:30</p>
                        </div>
                    </div>
                </div>
            `;

            // Start progress bar animation
            let progress = 0;
            let timeRemaining = 150; // 2.5 minutes in seconds
            const startTime = Date.now();
            
            const progressInterval = setInterval(() => {
                progress += 100 / 150; // Increment to reach 100% in 150 seconds
                timeRemaining--;
                
                const progressElement = document.getElementById('progressBar');
                const textElement = document.getElementById('progressText');
                
                if (progressElement && textElement) {
                    progressElement.style.width = Math.min(progress, 100) + '%';
                    
                    const minutes = Math.floor(timeRemaining / 60);
                    const seconds = timeRemaining % 60;
                    const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (timeRemaining > 0) {
                        textElement.textContent = `Estimated time remaining: ${timeString}`;
                    } else {
                        textElement.textContent = 'Processing may take longer than expected...';
                        progressElement.style.background = 'linear-gradient(90deg, #ffc107, #fd7e14)';
                    }
                } else {
                    clearInterval(progressInterval);
                }
            }, 1000);

            // Store the interval ID so we can clear it when the response arrives
            window.currentProgressInterval = progressInterval;

            let aiSuggestion = '';
            
            try {
                // Create the prompt for the AI model
                const prompt = `You are a medical AI assistant providing preliminary medical assessments. Analyze the following symptoms and provide a structured response.

Patient: ${patientName}

Symptoms:
${symptomsText}

Please provide:
1. Symptoms summary
2. Possible diagnoses (most to least likely) 
3. Recommended immediate actions
4. When to seek emergency care
5. Lifestyle recommendations
6. Important medical disclaimer

Format your response clearly with headers and bullet points. Be professional and include appropriate medical disclaimers.`;

                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'llama3:latest',
                        prompt: prompt,
                        stream: false,
                        options: {
                            temperature: 0.7,
                            top_p: 0.9
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                let rawResponse = data.response || 'Unable to generate AI response.';
                
                // Filter out thinking tags and content
                aiSuggestion = rawResponse
                    .replace(/<think>[\s\S]*?<\/think>/gi, '')
                    .replace(/^[\s\n]*/, '') // Remove leading whitespace
                    .trim();

            } catch (error) {
                console.error('Error calling Ollama API:', error);
                
                // Clear progress interval on error
                if (window.currentProgressInterval) {
                    clearInterval(window.currentProgressInterval);
                }
                
                // Fallback to local processing message
                aiSuggestion = `**Unable to connect to Ollama AI model (qwen3:30b)**

Error: ${error.message}

**Fallback Assessment:**

**Symptoms Summary:**
${symptomsText}

**General Recommendations:**
- Please consult with a healthcare professional for proper diagnosis
- Monitor your symptoms and seek medical attention if they worsen
- Keep a detailed symptom diary with dates, times, and severity levels
- Stay hydrated and get adequate rest

**When to Seek Immediate Medical Care:**
- Severe pain (8-10/10 on pain scale)
- Difficulty breathing or chest pain
- High fever (over 103°F/39.4°C)
- Sudden worsening of symptoms
- Any neurological symptoms (confusion, loss of consciousness)

**Important Note:** This system requires a local Ollama installation with the qwen3:30b model. Please ensure:
1. Ollama is installed and running on localhost:11434
2. The qwen3:30b model is downloaded (run: ollama pull qwen3:30b)
3. Your firewall allows local connections

**Medical Disclaimer:** This is a preliminary assessment tool. Always consult qualified healthcare professionals for proper medical diagnosis and treatment.`;
            }

            const submission = {
                id: Date.now(),
                patientName,
                symptoms: [...currentSymptoms],
                aiSuggestion,
                status: 'pending',
                timestamp: new Date().toISOString(),
                doctorName: null,
                doctorNotes: null,
                finalSuggestion: null
            };

            // Clear progress interval when response is complete
            if (window.currentProgressInterval) {
                clearInterval(window.currentProgressInterval);
            }

            database.submissions.push(submission);
            updateCounts();

            document.getElementById('aiResponse').innerHTML = `
                <div class="card" style="margin-top: 20px;">
                    <h2>AI Analysis Complete</h2>
                    <div class="success">✓ Your symptoms have been analyzed and sent to a doctor for review.</div>
                    <div class="suggestion-box">
                        <h3>AI Preliminary Suggestion (Ollama qwen3:30b):</h3>
                        <div class="markdown-content">${renderMarkdown(aiSuggestion)}</div>
                    </div>
                    <p style="margin-top: 15px;">
                        <strong>Status:</strong> <span class="status-badge status-pending">Pending Doctor Review</span>
                    </p>
                    <p style="margin-top: 10px; color: #666;">
                        You will be notified once a doctor reviews and approves the recommendations.
                    </p>
                </div>
            `;

            currentSymptoms = [];
            renderSymptomList();
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').textContent = 'Submit to AI Analysis';
            document.getElementById('patientName').value = '';
        }

        function loadPendingReviews() {
            const list = document.getElementById('pendingList');
            const pending = database.submissions.filter(s => s.status === 'pending');

            if (pending.length === 0) {
                list.innerHTML = '<p style="color: #999; padding: 20px;">No pending reviews.</p>';
                return;
            }

            list.innerHTML = pending.map(sub => `
                <div class="history-item" style="margin-top: 20px;">
                    <h3>Patient: ${sub.patientName}</h3>
                    <p style="color: #666; font-size: 13px;">Submitted: ${new Date(sub.timestamp).toLocaleString()}</p>
                    
                    <h4 style="margin-top: 15px;">Symptoms:</h4>
                    ${sub.symptoms.map(s => `
                        <div class="symptom-item">
                            <h4>${s.symptomType.toUpperCase()} - ${s.bodyPart.replace(/-/g, ' ').toUpperCase()}</h4>
                            <p><strong>Duration:</strong> ${s.duration.replace(/-/g, ' ')}</p>
                            <p><strong>Severity:</strong> ${s.severity}/10</p>
                        </div>
                    `).join('')}
                    
                    <div class="suggestion-box">
                        <h4>AI Suggestion:</h4>
                        <div class="markdown-content">${renderMarkdown(sub.aiSuggestion)}</div>
                    </div>

                    <div class="form-group" style="margin-top: 15px;">
                        <label>Doctor's Notes/Modifications</label>
                        <textarea id="notes-${sub.id}" placeholder="Add your professional assessment and any modifications to the AI suggestion..."></textarea>
                    </div>

                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="approveSubmission(${sub.id})">✓ Approve & Send to Patient</button>
                        <button class="btn btn-danger" onclick="rejectSubmission(${sub.id})">✗ Reject</button>
                    </div>
                </div>
            `).join('');
        }

        function approveSubmission(id) {
            const doctorName = document.getElementById('doctorName').value;
            if (!doctorName) {
                alert('Please enter your name');
                return;
            }

            const notes = document.getElementById('notes-' + id).value;
            const submission = database.submissions.find(s => s.id === id);
            
            submission.status = 'approved';
            submission.doctorName = doctorName;
            submission.doctorNotes = notes;
            submission.finalSuggestion = notes || submission.aiSuggestion;
            submission.approvedAt = new Date().toISOString();

            database.history.push({...submission});
            database.submissions = database.submissions.filter(s => s.id !== id);

            updateCounts();
            alert('✓ Approved! The patient will receive the recommendations.');
            loadPendingReviews();
        }

        function rejectSubmission(id) {
            if (confirm('Are you sure you want to reject this submission?')) {
                database.submissions = database.submissions.filter(s => s.id !== id);
                updateCounts();
                loadPendingReviews();
            }
        }

        function loadHistory() {
            const list = document.getElementById('historyList');
            
            if (database.history.length === 0) {
                list.innerHTML = '<p style="color: #999; padding: 20px;">No history records yet.</p>';
                return;
            }

            renderHistory(database.history);
        }

        function filterHistory() {
            const filter = document.getElementById('historyFilter').value.toLowerCase();
            const filtered = database.history.filter(h => 
                h.patientName.toLowerCase().includes(filter)
            );
            renderHistory(filtered);
        }

        function renderHistory(items) {
            const list = document.getElementById('historyList');
            
            if (items.length === 0) {
                list.innerHTML = '<p style="color: #999; padding: 20px;">No matching records found.</p>';
                return;
            }

            list.innerHTML = items.map(record => `
                <div class="history-item">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <div>
                            <h3>Patient: ${record.patientName}</h3>
                            <p style="color: #666; font-size: 13px;">
                                Submitted: ${new Date(record.timestamp).toLocaleString()}<br>
                                Approved: ${new Date(record.approvedAt).toLocaleString()}
                            </p>
                        </div>
                        <span class="status-badge status-approved">Approved</span>
                    </div>

                    <h4 style="margin-top: 15px;">Symptoms:</h4>
                    ${record.symptoms.map(s => `
                        <div class="symptom-item">
                            <h4>${s.symptomType.toUpperCase()} - ${s.bodyPart.replace(/-/g, ' ').toUpperCase()}</h4>
                            <p><strong>Duration:</strong> ${s.duration.replace(/-/g, ' ')}</p>
                            <p><strong>Severity:</strong> ${s.severity}/10</p>
                        </div>
                    `).join('')}

                    <div class="suggestion-box">
                        <h4>AI Initial Suggestion:</h4>
                        <div class="markdown-content">${renderMarkdown(record.aiSuggestion)}</div>
                    </div>

                    ${record.doctorNotes ? `
                        <div class="suggestion-box" style="background: #e8f5e9; border-color: #4caf50;">
                            <h4>Doctor's Assessment:</h4>
                            <div class="markdown-content">${renderMarkdown(record.doctorNotes)}</div>
                        </div>
                    ` : ''}

                    <div class="doctor-info">
                        <strong>Reviewed by:</strong> Dr. ${record.doctorName}
                    </div>
                </div>
            `).join('');
        }

        function updateCounts() {
            document.getElementById('pendingCount').textContent = database.submissions.length;
            document.getElementById('historyCount').textContent = database.history.length;
        }

        // Initialize
        updateCounts();
        
        // Initialize symptom dropdown with placeholder
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial state - user must select body area first
            document.getElementById('symptomType').innerHTML = '<option value="">Select a body area first to see relevant symptoms</option>';
        });
    </script>