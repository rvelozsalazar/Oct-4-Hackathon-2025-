<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Symptom Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .content {
            display: none;
        }

        .content.active {
            display: block;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .anatomy-container {
            position: relative;
            width: 100%;
            height: 600px;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .body-part {
            cursor: pointer;
            transition: all 0.3s;
        }

        .body-part:hover {
            opacity: 1 !important;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group select, .form-group input, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s;
            font-family: inherit;
        }

        .form-group select:focus, .form-group input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .symptom-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .symptom-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            position: relative;
        }

        .symptom-item h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .symptom-item p {
            color: #666;
            font-size: 13px;
            margin: 3px 0;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background: #ffc107;
            color: #000;
        }

        .status-approved {
            background: #28a745;
            color: white;
        }

        .history-item {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .suggestion-box {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #2196F3;
            white-space: pre-line;
        }

        .doctor-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 13px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            float: right;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        .badge-count {
            background: #dc3545;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 5px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Health Symptom Portal</h1>
            <p>Select body areas, describe symptoms, and receive AI-assisted medical guidance</p>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('patient')">Patient Portal</button>
                <button class="tab" onclick="switchTab('doctor')">
                    Doctor Portal <span class="badge-count" id="pendingCount">0</span>
                </button>
                <button class="tab" onclick="switchTab('history')">
                    History <span class="badge-count" id="historyCount">0</span>
                </button>
            </div>
        </div>

        <!-- Patient Portal -->
        <div id="patient-content" class="content active">
            <div class="main-grid">
                <div class="card">
                    <h2>Select Affected Body Area</h2>
                    <div class="anatomy-container">
                        <svg width="300" height="580" viewBox="0 0 300 580">
                            <defs>
                                <linearGradient id="skinGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ffd5b5;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#f4c5a0;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="muscleGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#d4a88c;stop-opacity:1" />
                                    <stop offset="50%" style="stop-color:#e6b896;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#d4a88c;stop-opacity:1" />
                                </linearGradient>
                                <radialGradient id="jointGradient">
                                    <stop offset="0%" style="stop-color:#f4c5a0;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#d4a88c;stop-opacity:1" />
                                </radialGradient>
                            </defs>

                            <!-- Head -->
                            <g class="body-part" data-part="head" onclick="selectBodyPart('head')" style="opacity:0.9">
                                <ellipse cx="150" cy="50" rx="42" ry="48" fill="url(#skinGradient)" stroke="#c99b7a" stroke-width="1.5"/>
                                <ellipse cx="138" cy="45" rx="6" ry="8" fill="#8b6f5c" opacity="0.3"/>
                                <ellipse cx="162" cy="45" rx="6" ry="8" fill="#8b6f5c" opacity="0.3"/>
                                <path d="M 135 62 Q 150 68 165 62" stroke="#c99b7a" stroke-width="1.5" fill="none"/>
                                <text x="150" y="95" text-anchor="middle" font-size="11" fill="#666" font-weight="500">Head</text>
                            </g>

                            <!-- Neck -->
                            <g class="body-part" data-part="neck" onclick="selectBodyPart('neck')" style="opacity:0.9">
                                <path d="M 130 90 L 125 115 L 175 115 L 170 90 Z" fill="url(#skinGradient)" stroke="#c99b7a" stroke-width="1"/>
                                <line x1="140" y1="95" x2="138" y2="115" stroke="#d4a88c" stroke-width="1.5" opacity="0.4"/>
                                <line x1="160" y1="95" x2="162" y2="115" stroke="#d4a88c" stroke-width="1.5" opacity="0.4"/>
                            </g>

                            <!-- Chest -->
                            <g class="body-part" data-part="chest" onclick="selectBodyPart('chest')" style="opacity:0.9">
                                <ellipse cx="150" cy="155" rx="65" ry="55" fill="url(#muscleGradient)" stroke="#c99b7a" stroke-width="1.5"/>
                                <path d="M 115 130 Q 150 140 185 130" stroke="#d4a88c" stroke-width="2" fill="none" opacity="0.5"/>
                                <line x1="150" y1="130" x2="150" y2="180" stroke="#d4a88c" stroke-width="2" opacity="0.4"/>
                                <ellipse cx="130" cy="155" rx="15" ry="20" fill="none" stroke="#d4a88c" stroke-width="1.5" opacity="0.3"/>
                                <ellipse cx="170" cy="155" rx="15" ry="20" fill="none" stroke="#d4a88c" stroke-width="1.5" opacity="0.3"/>
                                <text x="150" y="218" text-anchor="middle" font-size="11" fill="#666" font-weight="500">Chest</text>
                            </g>

                            <!-- Abdomen -->
                            <g class="body-part" data-part="abdomen" onclick="selectBodyPart('abdomen')" style="opacity:0.9">
                                <ellipse cx="150" cy="235" rx="58" ry="48" fill="url(#skinGradient)" stroke="#c99b7a" stroke-width="1.5"/>
                                <rect x="130" y="215" width="40" height="15" rx="2" fill="none" stroke="#d4a88c" stroke-width="1" opacity="0.3"/>
                                <rect x="130" y="232" width="40" height="15" rx="2" fill="none" stroke="#d4a88c" stroke-width="1" opacity="0.3"/>
                                <rect x="130" y="249" width="40" height="15" rx="2" fill="none" stroke="#d4a88c" stroke-width="1" opacity="0.3"/>
                                <circle cx="150" cy="240" r="8" fill="#d4a88c" opacity="0.2"/>
                                <text x="150" y="295" text-anchor="middle" font-size="11" fill="#666" font-weight="500">Abdomen</text>
                            </g>

                            <!-- Left Arm -->
                            <g class="body-part" data-part="left-arm" onclick="selectBodyPart('left-arm')" style="opacity:0.9">
                                <path d="M 90 135 Q 88 175 92 210" fill="url(#skinGradient)" stroke="#c99b7a" stroke-width="20" stroke-linecap="round"/>
                                <path d="M 88 145 Q 86 165 88 185" stroke="#d4a88c" stroke-width="3" fill="none" opacity="0.4"/>
                                <circle cx="90" cy="135" r="14" fill="url(#jointGradient)" stroke="#c99b7a" stroke-width="1"/>
                                <text x="60" y="175" font-size="11" fill="#666" font-weight="500">L Arm</text>
                            </g>

                            <!-- Right Arm -->
                            <g class="body-part" data-part="right-arm" onclick="selectBodyPart('right-arm')" style="opacity:0.9">
                                <path d="M 210 135 Q 212 175 208 210" fill="url(#skinGradient)" stroke="#c99b7a" stroke-width="20" stroke-linecap="round"/>
                                <path d="M 212 145 Q 214 165 212 185" stroke="#d4a88c" stroke-width="3" fill="none" opacity="0.4"/>
                                <circle cx="210" cy="135" r="14" fill="url(#jointGradient)" stroke="#c99b7a" stroke-width="1"/>
                                <text x="225" y="175" font-size="11" fill="#666" font-weight="500">R Arm</text>
                            </g>

                            <!-- Left Hand -->
                            <g class="body-part" data-part="left-hand" onclick="selectBodyPart('left-hand')" style="opacity:0.9">
                                <ellipse cx="92" cy="210" rx="10" ry="12" fill="url(#jointGradient)" stroke="#c99b7a" stroke-width="1"/>
                                <path d="M 92 222 L 88 250" stroke="#c99b7a" stroke-width="16" stroke-linecap="round" fill="url(#skinGradient)"/>
                                <ellipse cx="88" cy="255" rx="13" ry="16" fill="url(#skinGradient)" stroke="#c99b7a" stroke-width="1.5"/>
                                <path d="M 82 255 L 78 268" stroke="#c99b7a" stroke-width="3" stroke-linecap="round"/>
                                <path d="M 85 255 L 83 270" stroke="#c99b7a" stroke-width="3" stroke-linecap="round"/>
                                <path d="M 88 256 L 88 272" stroke="#c99b7a" stroke-width="3" stroke-linecap="round"/>
                                <path d="M 91 255 L 93 270" stroke="#c99b7a" stroke-width="3" stroke-linecap="round"/>
                                <path d="M 94 254 L 98 266" stroke="#c99b7a" stroke-width="3" stroke-linecap="round"/>
                                <text x="60" y="240" font-size="11" fill="#666" font-weight="500">L Hand</text>
                            </g>

                            <!-- Right Hand -->
                            <g class="body-part" data-part="right-hand" onclick="selectBodyPart('right-hand')" style="opacity:0.9">
                                <ellipse cx="208" cy="210" rx="10" ry="12" fill="url(#jointGradient)" stroke="#c99b7a" stroke-width="1"/>
                                <path d="M 208 222 L 212 250" stroke="#c99b7a" stroke-width="16" stroke-linecap="round" fill="url(#skinGradient)"/>
                                <ellipse cx="212" cy="255" rx="13" ry="16" fill="url(#skinGradient)" stroke="#c99b7a" stroke-width="1.5"/>
                                <path d="M 218 255 L 222 268" stroke="#c99b7a" stroke-width="3" stroke-linecap="round"/>
                                <path d="M 215 255 L 217 270" stroke="#c99b7a" stroke-width="3" stroke-linecap="round"/>
                                <path d="M 212 256 L 212 272" stroke="#c99b7a" stroke-width="3" stroke-linecap="round"/>
                                <path d="M 209 255 L 207 270" stroke="#c99b7a" stroke-width="3" stroke-linecap="round"/>
                                <path d="M 206 254 L 202 266" stroke="#c99b7a" stroke-width="3" stroke-linecap="round"/>
                                <text x="220" y="240" font-size="11" fill="#666" font-weight="500">R Hand</text>
                            </g>

                            <!-- Pelvis -->
                            <path d="M 110 280 L 105 300 L 195 300 L 190 280 Z" fill="url(#skinGradient)" stroke="#c99b7a" stroke-width="1.5" opacity="0.9"/>

                            <!-- Left Leg -->
                            <g class="body-part" data-part="left-leg" onclick="selectBodyPart('left-leg')" style="opacity:0.9">
                                <path d="M 120 300 Q 118 360 122 430" fill="url(#muscleGradient)" stroke="#c99b7a" stroke-width="24" stroke-linecap="round"/>
                                <ellipse cx="120" cy="305" rx="14" ry="12" fill="url(#jointGradient)" stroke="#c99b7a" stroke-width="1"/>
                                <path d="M 116 320 Q 114 360 116 400" stroke="#d4a88c" stroke-width="3" fill="none" opacity="0.4"/>
                                <ellipse cx="122" cy="360" rx="10" ry="14" fill="none" stroke="#d4a88c" stroke-width="1.5" opacity="0.3"/>
                                <text x="90" y="370" font-size="11" fill="#666" font-weight="500">L Leg</text>
                            </g>

                            <!-- Right Leg -->
                            <g class="body-part" data-part="right-leg" onclick="selectBodyPart('right-leg')" style="opacity:0.9">
                                <path d="M 180 300 Q 182 360 178 430" fill="url(#muscleGradient)" stroke="#c99b7a" stroke-width="24" stroke-linecap="round"/>
                                <ellipse cx="180" cy="305" rx="14" ry="12" fill="url(#jointGradient)" stroke="#c99b7a" stroke-width="1"/>
                                <path d="M 184 320 Q 186 360 184 400" stroke="#d4a88c" stroke-width="3" fill="none" opacity="0.4"/>
                                <ellipse cx="178" cy="360" rx="10" ry="14" fill="none" stroke="#d4a88c" stroke-width="1.5" opacity="0.3"/>
                                <text x="195" y="370" font-size="11" fill="#666" font-weight="500">R Leg</text>
                            </g>

                            <!-- Left Foot -->
                            <g class="body-part" data-part="left-foot" onclick="selectBodyPart('left-foot')" style="opacity:0.9">
                                <ellipse cx="122" cy="430" rx="11" ry="13" fill="url(#jointGradient)" stroke="#c99b7a" stroke-width="1"/>
                                <ellipse cx="120" cy="455" rx="22" ry="16" fill="url(#skinGradient)" stroke="#c99b7a" stroke-width="1.5"/>
                                <line x1="108" y1="455" x2="100" y2="465" stroke="#c99b7a" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="114" y1="456" x2="108" y2="468" stroke="#c99b7a" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="120" y1="457" x2="116" y2="470" stroke="#c99b7a" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="126" y1="456" x2="124" y2="469" stroke="#c99b7a" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="132" y1="455" x2="132" y2="466" stroke="#c99b7a" stroke-width="2.5" stroke-linecap="round"/>
                                <text x="85" y="475" font-size="11" fill="#666" font-weight="500">L Foot</text>
                            </g>

                            <!-- Right Foot -->
                            <g class="body-part" data-part="right-foot" onclick="selectBodyPart('right-foot')" style="opacity:0.9">
                                <ellipse cx="178" cy="430" rx="11" ry="13" fill="url(#jointGradient)" stroke="#c99b7a" stroke-width="1"/>
                                <ellipse cx="180" cy="455" rx="22" ry="16" fill="url(#skinGradient)" stroke="#c99b7a" stroke-width="1.5"/>
                                <line x1="192" y1="455" x2="200" y2="465" stroke="#c99b7a" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="186" y1="456" x2="192" y2="468" stroke="#c99b7a" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="180" y1="457" x2="184" y2="470" stroke="#c99b7a" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="174" y1="456" x2="176" y2="469" stroke="#c99b7a" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="168" y1="455" x2="168" y2="466" stroke="#c99b7a" stroke-width="2.5" stroke-linecap="round"/>
                                <text x="195" y="475" font-size="11" fill="#666" font-weight="500">R Foot</text>
                            </g>

                            <!-- Back/Spine -->
                            <g class="body-part" data-part="back" onclick="selectBodyPart('back')" style="opacity:0.9">
                                <line x1="150" y1="120" x2="150" y2="280" stroke="#a88b75" stroke-width="4" opacity="0.6"/>
                                <circle cx="150" cy="140" r="4" fill="#a88b75" opacity="0.5"/>
                                <circle cx="150" cy="160" r="4" fill="#a88b75" opacity="0.5"/>
                                <circle cx="150" cy="180" r="4" fill="#a88b75" opacity="0.5"/>
                                <circle cx="150" cy="200" r="4" fill="#a88b75" opacity="0.5"/>
                                <circle cx="150" cy="220" r="4" fill="#a88b75" opacity="0.5"/>
                                <circle cx="150" cy="240" r="4" fill="#a88b75" opacity="0.5"/>
                                <circle cx="150" cy="260" r="4" fill="#a88b75" opacity="0.5"/>
                                <text x="150" y="300" text-anchor="middle" font-size="11" fill="#666" font-weight="500">Back/Spine</text>
                            </g>
                        </svg>
                    </div>
                    <p style="text-align: center; color: #666; margin-top: 10px;">Click on body areas to select ‚Ä¢ Anatomically detailed diagram</p>
                </div>

                <div class="card">
                    <h2>Symptom Details</h2>
                    <div class="form-group">
                        <label>Patient Name</label>
                        <input type="text" id="patientName" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label>Selected Body Part</label>
                        <input type="text" id="selectedPart" readonly placeholder="Click on body diagram" style="background: #f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>Symptom/Condition</label>
                        <select id="symptomType">
                            <option value="">Select symptom...</option>
                            <option value="pain">Pain</option>
                            <option value="swelling">Swelling</option>
                            <option value="redness">Redness/Inflammation</option>
                            <option value="numbness">Numbness/Tingling</option>
                            <option value="weakness">Weakness</option>
                            <option value="stiffness">Stiffness</option>
                            <option value="rash">Rash/Skin Issue</option>
                            <option value="breathing">Breathing Difficulty</option>
                            <option value="dizziness">Dizziness</option>
                            <option value="nausea">Nausea</option>
                            <option value="fever">Fever</option>
                            <option value="fatigue">Fatigue</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Duration</label>
                        <select id="duration">
                            <option value="">Select duration...</option>
                            <option value="less-than-1-day">Less than 1 day</option>
                            <option value="1-3-days">1-3 days</option>
                            <option value="4-7-days">4-7 days</option>
                            <option value="1-2-weeks">1-2 weeks</option>
                            <option value="2-4-weeks">2-4 weeks</option>
                            <option value="1-3-months">1-3 months</option>
                            <option value="more-than-3-months">More than 3 months</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Severity (1-10)</label>
                        <input type="number" id="severity" min="1" max="10" placeholder="1 (mild) to 10 (severe)">
                    </div>
                    <button class="btn btn-primary" onclick="addSymptom()">Add Symptom</button>
                </div>
            </div>

            <div class="card">
                <h2>Current Symptoms</h2>
                <div class="symptom-list" id="symptomList">
                    <p style="color: #999;">No symptoms added yet. Add symptoms using the form above.</p>
                </div>
                <button class="btn btn-primary" onclick="submitToAI()" id="submitBtn" disabled>Submit to AI Analysis</button>
            </div>

            <div id="aiResponse"></div>
        </div>

        <!-- Doctor Portal -->
        <div id="doctor-content" class="content">
            <div class="card">
                <h2>Pending Reviews</h2>
                <div class="form-group">
                    <label>Doctor Name</label>
                    <input type="text" id="doctorName" placeholder="Enter your name">
                </div>
                <div id="pendingList"></div>
            </div>
        </div>

        <!-- History -->
        <div id="history-content" class="content">
            <div class="card">
                <h2>Patient History</h2>
                <div class="form-group">
                    <label>Filter by Patient Name</label>
                    <input type="text" id="historyFilter" placeholder="Enter patient name" onkeyup="filterHistory()">
                </div>
                <div id="historyList"></div>
            </div>
        </div>
    </div>

    <script>
        // Database
        const database = {
            submissions: [],
            history: []
        };

        let currentSymptoms = [];
        let selectedBodyPart = null;

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-content').classList.add('active');
            
            if (tab === 'doctor') {
                loadPendingReviews();
            } else if (tab === 'history') {
                loadHistory();
            }
        }

        function selectBodyPart(part) {
            document.querySelectorAll('.body-part').forEach(p => {
                p.style.filter = '';
                p.style.opacity = '0.9';
            });
            event.currentTarget.style.filter = 'drop-shadow(0 0 12px rgb(99 102 241))';
            event.currentTarget.style.opacity = '1';
            selectedBodyPart = part;
            document.getElementById('selectedPart').value = part.replace(/-/g, ' ').toUpperCase();
        }

        function addSymptom() {
            const patientName = document.getElementById('patientName').value;
            const bodyPart = selectedBodyPart;
            const symptomType = document.getElementById('symptomType').value;
            const duration = document.getElementById('duration').value;
            const severity = document.getElementById('severity').value;

            if (!patientName || !bodyPart || !symptomType || !duration || !severity) {
                alert('Please fill in all fields and select a body part');
                return;
            }

            const symptom = {
                id: Date.now(),
                patientName,
                bodyPart,
                symptomType,
                duration,
                severity: parseInt(severity)
            };

            currentSymptoms.push(symptom);
            renderSymptomList();
            
            document.getElementById('symptomType').value = '';
            document.getElementById('duration').value = '';
            document.getElementById('severity').value = '';
            document.querySelectorAll('.body-part').forEach(p => {
                p.style.filter = '';
                p.style.opacity = '0.9';
            });
            selectedBodyPart = null;
            document.getElementById('selectedPart').value = '';

            document.getElementById('submitBtn').disabled = false;
        }

        function removeSymptom(id) {
            currentSymptoms = currentSymptoms.filter(s => s.id !== id);
            renderSymptomList();
            if (currentSymptoms.length === 0) {
                document.getElementById('submitBtn').disabled = true;
            }
        }

        function renderSymptomList() {
            const list = document.getElementById('symptomList');
            if (currentSymptoms.length === 0) {
                list.innerHTML = '<p style="color: #999;">No symptoms added yet.</p>';
                return;
            }

            list.innerHTML = currentSymptoms.map(s => `
                <div class="symptom-item">
                    <button class="remove-btn" onclick="removeSymptom(${s.id})">Remove</button>
                    <h4>${s.symptomType.toUpperCase()} - ${s.bodyPart.replace(/-/g, ' ').toUpperCase()}</h4>
                    <p><strong>Duration:</strong> ${s.duration.replace(/-/g, ' ')}</p>
                    <p><strong>Severity:</strong> ${s.severity}/10</p>
                </div>
            `).join('');
        }

        async function submitToAI() {
            if (currentSymptoms.length === 0) return;

            const patientName = currentSymptoms[0].patientName;
            const symptomsText = currentSymptoms.map(s => 
                `- ${s.symptomType} in ${s.bodyPart.replace(/-/g, ' ')}, Duration: ${s.duration.replace(/-/g, ' ')}, Severity: ${s.severity}/10`
            ).join('\n');

            // Show loading state
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').textContent = 'Analyzing with AI...';
            
            document.getElementById('aiResponse').innerHTML = `
                <div class="card" style="margin-top: 20px;">
                    <h2>AI Analysis in Progress</h2>
                    <div style="text-align: center; padding: 20px;">
                        <div style="display: inline-block; animation: spin 1s linear infinite; width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #667eea; border-radius: 50%;"></div>
                        <p style="margin-top: 10px; color: #666;">Consulting Ollama AI model (qwen3:30b)...</p>
                        <div style="margin-top: 20px;">
                            <div style="width: 100%; background-color: #f0f0f0; border-radius: 10px; height: 20px; overflow: hidden;">
                                <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 10px; transition: width 0.5s ease;"></div>
                            </div>
                            <p id="progressText" style="margin-top: 10px; color: #666; font-size: 14px;">Estimated time remaining: 2:30</p>
                        </div>
                    </div>
                </div>
            `;

            // Start progress bar animation
            let progress = 0;
            let timeRemaining = 150; // 2.5 minutes in seconds
            const startTime = Date.now();
            
            const progressInterval = setInterval(() => {
                progress += 100 / 150; // Increment to reach 100% in 150 seconds
                timeRemaining--;
                
                const progressElement = document.getElementById('progressBar');
                const textElement = document.getElementById('progressText');
                
                if (progressElement && textElement) {
                    progressElement.style.width = Math.min(progress, 100) + '%';
                    
                    const minutes = Math.floor(timeRemaining / 60);
                    const seconds = timeRemaining % 60;
                    const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (timeRemaining > 0) {
                        textElement.textContent = `Estimated time remaining: ${timeString}`;
                    } else {
                        textElement.textContent = 'Processing may take longer than expected...';
                        progressElement.style.background = 'linear-gradient(90deg, #ffc107, #fd7e14)';
                    }
                } else {
                    clearInterval(progressInterval);
                }
            }, 1000);

            // Store the interval ID so we can clear it when the response arrives
            window.currentProgressInterval = progressInterval;

            let aiSuggestion = '';
            
            try {
                // Create the prompt for the AI model
                const prompt = `You are a medical AI assistant providing preliminary medical assessments. Analyze the following symptoms and provide a structured response.

Patient: ${patientName}

Symptoms:
${symptomsText}

Please provide:
1. Symptoms summary
2. Possible diagnoses (most to least likely) 
3. Recommended immediate actions
4. When to seek emergency care
5. Lifestyle recommendations
6. Important medical disclaimer

Format your response clearly with headers and bullet points. Be professional and include appropriate medical disclaimers.`;

                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'qwen3:30b',
                        prompt: prompt,
                        stream: false,
                        options: {
                            temperature: 0.7,
                            top_p: 0.9
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                let rawResponse = data.response || 'Unable to generate AI response.';
                
                // Filter out thinking tags and content
                aiSuggestion = rawResponse
                    .replace(/<think>[\s\S]*?<\/think>/gi, '')
                    .replace(/^[\s\n]*/, '') // Remove leading whitespace
                    .trim();

            } catch (error) {
                console.error('Error calling Ollama API:', error);
                
                // Clear progress interval on error
                if (window.currentProgressInterval) {
                    clearInterval(window.currentProgressInterval);
                }
                
                // Fallback to local processing message
                aiSuggestion = `**Unable to connect to Ollama AI model (qwen3:30b)**

Error: ${error.message}

**Fallback Assessment:**

**Symptoms Summary:**
${symptomsText}

**General Recommendations:**
- Please consult with a healthcare professional for proper diagnosis
- Monitor your symptoms and seek medical attention if they worsen
- Keep a detailed symptom diary with dates, times, and severity levels
- Stay hydrated and get adequate rest

**When to Seek Immediate Medical Care:**
- Severe pain (8-10/10 on pain scale)
- Difficulty breathing or chest pain
- High fever (over 103¬∞F/39.4¬∞C)
- Sudden worsening of symptoms
- Any neurological symptoms (confusion, loss of consciousness)

**Important Note:** This system requires a local Ollama installation with the qwen3:30b model. Please ensure:
1. Ollama is installed and running on localhost:11434
2. The qwen3:30b model is downloaded (run: ollama pull qwen3:30b)
3. Your firewall allows local connections

**Medical Disclaimer:** This is a preliminary assessment tool. Always consult qualified healthcare professionals for proper medical diagnosis and treatment.`;
            }

            const submission = {
                id: Date.now(),
                patientName,
                symptoms: [...currentSymptoms],
                aiSuggestion,
                status: 'pending',
                timestamp: new Date().toISOString(),
                doctorName: null,
                doctorNotes: null,
                finalSuggestion: null
            };

            // Clear progress interval when response is complete
            if (window.currentProgressInterval) {
                clearInterval(window.currentProgressInterval);
            }

            database.submissions.push(submission);
            updateCounts();

            document.getElementById('aiResponse').innerHTML = `
                <div class="card" style="margin-top: 20px;">
                    <h2>AI Analysis Complete</h2>
                    <div class="success">‚úì Your symptoms have been analyzed and sent to a doctor for review.</div>
                    <div class="suggestion-box">
                        <h3>AI Preliminary Suggestion (Ollama qwen3:30b):</h3>
                        <div style="white-space: pre-line;">${aiSuggestion}</div>
                    </div>
                    <p style="margin-top: 15px;">
                        <strong>Status:</strong> <span class="status-badge status-pending">Pending Doctor Review</span>
                    </p>
                    <p style="margin-top: 10px; color: #666;">
                        You will be notified once a doctor reviews and approves the recommendations.
                    </p>
                </div>
            `;

            currentSymptoms = [];
            renderSymptomList();
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').textContent = 'Submit to AI Analysis';
            document.getElementById('patientName').value = '';
        }

        function loadPendingReviews() {
            const list = document.getElementById('pendingList');
            const pending = database.submissions.filter(s => s.status === 'pending');

            if (pending.length === 0) {
                list.innerHTML = '<p style="color: #999; padding: 20px;">No pending reviews.</p>';
                return;
            }

            list.innerHTML = pending.map(sub => `
                <div class="history-item" style="margin-top: 20px;">
                    <h3>Patient: ${sub.patientName}</h3>
                    <p style="color: #666; font-size: 13px;">Submitted: ${new Date(sub.timestamp).toLocaleString()}</p>
                    
                    <h4 style="margin-top: 15px;">Symptoms:</h4>
                    ${sub.symptoms.map(s => `
                        <div class="symptom-item">
                            <h4>${s.symptomType.toUpperCase()} - ${s.bodyPart.replace(/-/g, ' ').toUpperCase()}</h4>
                            <p><strong>Duration:</strong> ${s.duration.replace(/-/g, ' ')}</p>
                            <p><strong>Severity:</strong> ${s.severity}/10</p>
                        </div>
                    `).join('')}
                    
                    <div class="suggestion-box">
                        <h4>AI Suggestion:</h4>
                        <div>${sub.aiSuggestion}</div>
                    </div>

                    <div class="form-group" style="margin-top: 15px;">
                        <label>Doctor's Notes/Modifications</label>
                        <textarea id="notes-${sub.id}" placeholder="Add your professional assessment and any modifications to the AI suggestion..."></textarea>
                    </div>

                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="approveSubmission(${sub.id})">‚úì Approve & Send to Patient</button>
                        <button class="btn btn-danger" onclick="rejectSubmission(${sub.id})">‚úó Reject</button>
                    </div>
                </div>
            `).join('');
        }

        function approveSubmission(id) {
            const doctorName = document.getElementById('doctorName').value;
            if (!doctorName) {
                alert('Please enter your name');
                return;
            }

            const notes = document.getElementById('notes-' + id).value;
            const submission = database.submissions.find(s => s.id === id);
            
            submission.status = 'approved';
            submission.doctorName = doctorName;
            submission.doctorNotes = notes;
            submission.finalSuggestion = notes || submission.aiSuggestion;
            submission.approvedAt = new Date().toISOString();

            database.history.push({...submission});
            database.submissions = database.submissions.filter(s => s.id !== id);

            updateCounts();
            alert('‚úì Approved! The patient will receive the recommendations.');
            loadPendingReviews();
        }

        function rejectSubmission(id) {
            if (confirm('Are you sure you want to reject this submission?')) {
                database.submissions = database.submissions.filter(s => s.id !== id);
                updateCounts();
                loadPendingReviews();
            }
        }

        function loadHistory() {
            const list = document.getElementById('historyList');
            
            if (database.history.length === 0) {
                list.innerHTML = '<p style="color: #999; padding: 20px;">No history records yet.</p>';
                return;
            }

            renderHistory(database.history);
        }

        function filterHistory() {
            const filter = document.getElementById('historyFilter').value.toLowerCase();
            const filtered = database.history.filter(h => 
                h.patientName.toLowerCase().includes(filter)
            );
            renderHistory(filtered);
        }

        function renderHistory(items) {
            const list = document.getElementById('historyList');
            
            if (items.length === 0) {
                list.innerHTML = '<p style="color: #999; padding: 20px;">No matching records found.</p>';
                return;
            }

            list.innerHTML = items.map(record => `
                <div class="history-item">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <div>
                            <h3>Patient: ${record.patientName}</h3>
                            <p style="color: #666; font-size: 13px;">
                                Submitted: ${new Date(record.timestamp).toLocaleString()}<br>
                                Approved: ${new Date(record.approvedAt).toLocaleString()}
                            </p>
                        </div>
                        <span class="status-badge status-approved">Approved</span>
                    </div>

                    <h4 style="margin-top: 15px;">Symptoms:</h4>
                    ${record.symptoms.map(s => `
                        <div class="symptom-item">
                            <h4>${s.symptomType.toUpperCase()} - ${s.bodyPart.replace(/-/g, ' ').toUpperCase()}</h4>
                            <p><strong>Duration:</strong> ${s.duration.replace(/-/g, ' ')}</p>
                            <p><strong>Severity:</strong> ${s.severity}/10</p>
                        </div>
                    `).join('')}

                    <div class="suggestion-box">
                        <h4>AI Initial Suggestion:</h4>
                        <div>${record.aiSuggestion}</div>
                    </div>

                    ${record.doctorNotes ? `
                        <div class="suggestion-box" style="background: #e8f5e9; border-color: #4caf50;">
                            <h4>Doctor's Assessment:</h4>
                            <div>${record.doctorNotes}</div>
                        </div>
                    ` : ''}

                    <div class="doctor-info">
                        <strong>Reviewed by:</strong> Dr. ${record.doctorName}
                    </div>
                </div>
            `).join('');
        }

        function updateCounts() {
            document.getElementById('pendingCount').textContent = database.submissions.length;
            document.getElementById('historyCount').textContent = database.history.length;
        }

        // Initialize
        updateCounts();
    </script>